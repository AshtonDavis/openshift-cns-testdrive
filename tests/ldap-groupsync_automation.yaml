---

- name: Automation of LDAP and user manipulation module
  hosts: masters
  become_user: root
  
  tasks: 
    - name: Login as system:admin
      command: oc login -u system:admin

    - name: Sync all of the LDAP groups
      command: oc adm groups sync --sync-config=/home/cloud-user/groupsync.yaml --confirm

    - name: Give cluster-reader to fancy-dev
      command: oc adm policy add-cluster-role-to-group cluster-reader ose-fancy-dev

    - name: Create app-dev project
      block:
        - command: oc get project {{ item[0] }}
          register: project_out
        - command: 'oc adm new-project {{ item[0] }} --display-name="{{ item[1] }}"'
          when: project_out | failed
      with_items:
        - ["app-dev", "Application Development"]
